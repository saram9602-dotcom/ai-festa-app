<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI ì†Œì„¤ ì²´í—˜ ë¶€ìŠ¤</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 920px; margin: 32px auto; padding: 0 16px; }
      h1 { margin: 0 0 12px; }
      .card { border: 1px solid #e5e7eb; border-radius: 16px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
      label { display:block; font-weight:600; margin:16px 0 8px; }
      input, textarea { width: 100%; border: 1px solid #cbd5e1; border-radius: 10px; padding: 12px; font-size: 16px; }
      textarea { min-height: 88px; }
      button { margin-top: 16px; padding: 12px 16px; border: 0; border-radius: 12px; font-weight: 700; cursor: pointer; }
      .primary { background: #111827; color: white; }
      .ghost { background: #f3f4f6; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .result { white-space: pre-wrap; background: #f9fafb; border-radius: 12px; padding: 12px; margin-top: 12px; border: 1px dashed #e5e7eb; }
      .hint { color: #6b7280; font-size: 14px; }
    </style>
  </head>
  <body>
    <h1>ğŸš€ AIì™€ í•¨ê»˜ 'ì¸ìƒ ê²½í—˜' ì†Œì„¤ë¡œ ë§Œë“¤ê¸°</h1>
    <p class="hint">í™œë™ ìˆœì„œ: ê²½í—˜ ì…ë ¥ â†’ <b>ì†Œì„¤ ì¤„ê±°ë¦¬ ìë™ ìƒì„±</b> â†’ ì´ë©”ì¼ë¡œ ê²°ê³¼ ë°›ê¸°(ì„ íƒ)</p>

    <div class="card">
      <h2>1) ë‚˜ì˜ ê²½í—˜ ì…ë ¥</h2>

      <label>ì£¼ì¸ê³µ ì´ë¦„</label>
      <input id="heroName" placeholder="ì˜ˆ) ì§€ìš°, ë¯¼ì¤€, ìˆ˜ì•„ ë“±" />

      <label>ê°€ì¥ ì¸ìƒ ê¹Šì—ˆë˜ ê²½í—˜</label>
      <textarea id="experience" placeholder="ì˜ˆ) ê°€ì¡± ì—¬í–‰ì—ì„œ ê¸¸ì„ ìƒì—ˆë˜ ì¼..."></textarea>

      <div class="row">
        <div>
          <label>ê·¸ë•Œ ê°€ì¥ ê°•í–ˆë˜ ê°ì •</label>
          <input id="emotion" placeholder="ì˜ˆ) ë‘ë ¤ì›€, ë¿Œë“¯í•¨ ë“±" />
        </div>
        <div>
          <label>ì–¸ì œ/ì–´ë””ì„œ</label>
          <input id="whenWhere" placeholder="ì˜ˆ) ì—¬ë¦„ë°©í•™, ê°•ë¦‰ í•´ë³€" />
        </div>
      </div>

      <label>ì‹œì‘ ê³„ê¸°(ë°œë‹¨)</label>
      <input id="inciting" placeholder="ì˜ˆ) ì‹ ê¸°í•œ ë¬¼ê±´ì„ ë°œê²¬í–ˆë‹¤" />

      <label>ê°€ì¥ í° ë¬¸ì œ(ê°ˆë“±)</label>
      <input id="conflict" placeholder="ì˜ˆ) ì¹œêµ¬ê°€ ì‚¬ë¼ì¡Œë‹¤" />

      <label>ì–´ë–»ê²Œ í•´ê²°í–ˆë‚˜ìš”?</label>
      <input id="resolution" placeholder="ì˜ˆ) ì¹¨ì°©í•˜ê²Œ ì£¼ë³€ì„ íƒìƒ‰í•˜ê³  ì–´ë¥¸ì—ê²Œ ë„ì›€ì„ ìš”ì²­í–ˆë‹¤" />

      <div style="display:flex; gap:8px; align-items:center;">
        <button id="btn-generate" class="primary">ì†Œì„¤ ì¤„ê±°ë¦¬ ìƒì„±</button>
        <button id="btn-clear" class="ghost" type="button">ì…ë ¥ ì§€ìš°ê¸°</button>
      </div>

      <div id="result" class="result" style="display:none;"></div>

      <h3 style="margin-top:24px;">2) ì´ë©”ì¼ë¡œ ê²°ê³¼ ë°›ê¸°(ì„ íƒ)</h3>
      <label>ë°›ëŠ” ì´ë©”ì¼ ì£¼ì†Œ</label>
      <input id="email" type="email" placeholder="ì˜ˆ) student@example.com" />
      <button id="btn-send" class="ghost" type="button">ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°</button>
      <div id="send-status" class="hint" style="margin-top:8px;"></div>
    </div>

    <script>
      const qs = (id) => document.getElementById(id);
      const btnGenerate = qs('btn-generate');
      const btnClear = qs('btn-clear');
      const btnSend = qs('btn-send');
      const resultBox = qs('result');

      function payloadFromInputs() {
        return {
          heroName: qs('heroName').value.trim(),
          experience: qs('experience').value.trim(),
          emotion: qs('emotion').value.trim(),
          whenWhere: qs('whenWhere').value.trim(),
          inciting: qs('inciting').value.trim(),
          conflict: qs('conflict').value.trim(),
          resolution: qs('resolution').value.trim(),
          email: qs('email').value.trim() || null,
        };
      }

      async function callApi(mode, extra = {}) {
        const res = await fetch('/api/processStory', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ mode, ...payloadFromInputs(), ...extra })
        });
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      }

      btnGenerate.addEventListener('click', async () => {
        const data = payloadFromInputs();
        if (!data.experience) { alert('ê°€ì¥ ì¸ìƒ ê¹Šì—ˆë˜ ê²½í—˜ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
        resultBox.style.display = 'block';
        resultBox.textContent = 'ìƒì„± ì¤‘...';
        try {
          const json = await callApi('generate');
          resultBox.textContent = json.story || '(ê²°ê³¼ ì—†ìŒ)';
        } catch (err) {
          console.error(err);
          resultBox.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
        }
      });

      btnClear.addEventListener('click', () => {
        ['heroName','experience','emotion','whenWhere','inciting','conflict','resolution','email'].forEach(id => qs(id).value = '');
        resultBox.textContent = '';
        resultBox.style.display = 'none';
        qs('send-status').textContent = '';
      });

      btnSend.addEventListener('click', async () => {
        const data = payloadFromInputs();
        if (!resultBox.textContent) { alert('ë¨¼ì € ì†Œì„¤ ì¤„ê±°ë¦¬ë¥¼ ìƒì„±í•´ ì£¼ì„¸ìš”.'); return; }
        if (!data.email) { alert('ë°›ëŠ” ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
        qs('send-status').textContent = 'ì´ë©”ì¼ ì „ì†¡ ì¤‘...';
        try {
          const json = await callApi('send', { story: resultBox.textContent });
          qs('send-status').textContent = json.ok ? 'ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì „ì†¡ ì‹¤íŒ¨';
        } catch (err) {
          console.error(err);
          qs('send-status').textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ ì£¼ì†Œë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
        }
      });
    </script>
  </body>
</html>
