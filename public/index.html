<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI ì²´í—˜ì†Œì„¤ â€” v15d</title>
<style>
  :root{--bg:#0a0f1a;--card:#0f172a;--muted:#cbd5e1;--text:#f8fafc;--border:#334155;--accent:#8b5cf6;--ok:#10b981;--warn:#eab308}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,"Noto Sans KR","Malgun Gothic",sans-serif}
  header{position:sticky;top:0;background:linear-gradient(to bottom,rgba(10,15,26,.95),rgba(10,15,26,.85));backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:50}
  .wrap{max-width:1220px;margin:0 auto;padding:14px 16px}
  .title{display:flex;gap:12px;align-items:center}
  .logo{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:conic-gradient(from 0deg,#8b5cf6,#22d3ee,#8b5cf6);font-weight:900;color:#0a0f1a}
  .grid{display:grid;gap:16px;grid-template-columns:500px 1fr}
  @media(max-width:1100px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .head{padding:16px 16px 0 16px}.body{padding:16px}.muted{color:var(--muted)}
  input,select{width:100%;background:#0b1320;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px 14px;font:inherit}
  .btn{background:linear-gradient(180deg,rgba(139,92,246,.9),rgba(139,92,246,.75));color:#fff;border:none;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
  .btn.secondary{background:#0b1320;border:1px solid var(--border);color:var(--text)} .btn.ok{background:linear-gradient(180deg,rgba(16,185,129,.9),rgba(16,185,129,.75))}
  .btn.warn{background:linear-gradient(180deg,rgba(234,179,8,.9),rgba(234,179,8,.75))}
  .topics{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-height:360px;overflow:auto;border:1px dashed #3b475a;border-radius:12px;background:#0b1320;padding:12px}
  .topic{display:flex;gap:10px;align-items:center;padding:10px;border:1px solid var(--border);border-radius:12px;background:#0e1627;cursor:pointer;color:#e5e7eb;font-weight:700}
  .topic.active{outline:2px solid var(--accent)} .topic .icon{width:30px;height:30px;border-radius:8px;background:#1f2937;display:grid;place-items:center;font-size:18px}
  .chat{display:flex;flex-direction:column;gap:12px;max-height:360px;overflow:auto;border:1px dashed #3b475a;border-radius:12px;background:#0b1320;padding:12px}
  .msg{display:flex;gap:10px;align-items:flex-start}.role{width:30px;height:30px;border-radius:999px;display:grid;place-items:center;background:#182235}
  .bubble{padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#111827;max-width:100%;font-size:16px;line-height:1.7}
  .me .bubble{background:#0f1b2e} .story{min-height:360px;border:1px dashed #3b475a;border-radius:12px;background:#0b1320;padding:16px;white-space:pre-wrap;line-height:1.9;font-size:18px}
  .cover-holder{display:grid;place-items:center;min-height:300px;border:1px dashed #3b475a;border-radius:12px;background:#0b1320;padding:12px}
  .cover-holder img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
  .proc{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}.step{padding:10px;border-radius:12px;border:1px solid #3b475a;background:#0b1320}
  .bar{height:8px;border-radius:999px;background:#0f172a;border:1px solid #334155;overflow:hidden}.fill{height:100%;width:0;background:linear-gradient(90deg,#22d3ee,#8b5cf6)}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <div class="logo">AI</div>
      <div>
        <div style="font-weight:900;font-size:20px">AI ì²´í—˜ì†Œì„¤ â€” v15d</div>
        <div class="muted" style="font-size:13px">ì†Œì„¤ ì“°ëŠ” ê³¼ì •ì„ í™”ë©´ì— ë³´ì—¬ì£¼ê³ , ì™„ì„± í›„ í‘œì§€ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.</div>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button class="btn secondary" id="resetBtn">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap" style="margin:14px 0 20px">
  <div style="display:grid;gap:16px;grid-template-columns:500px 1fr">
    <section class="card">
      <div class="head"><h2>1) ì²´í—˜ ì£¼ì œ ì„ íƒ (30ê°œ + ììœ )</h2><div class="muted">ì›í•˜ëŠ” ì²´í—˜ì„ ê³ ë¥´ê±°ë‚˜, ì•„ë˜ â€˜ììœ  ì£¼ì œâ€™ë¥¼ ì´ìš©í•˜ì„¸ìš”.</div></div>
      <div class="body">
        <div class="topics" id="topics"></div>
        <div style="display:flex;gap:8px;margin-top:10px"><input id="customTopic" type="text" placeholder="ììœ  ì£¼ì œ(ì˜ˆ: í•´ë…€ ì²´í—˜, ì§€í•˜ì²  íƒí—˜ ë“±)" /><button class="btn" id="useCustom">ììœ  ì£¼ì œë¡œ ì‹œì‘</button></div>
      </div>
      <div class="head"><h2>2) ì§ˆë¬¸ì— ë‹µí•˜ê±°ë‚˜, ì˜ˆì‹œë¡œ ë°”ë¡œ ë§Œë“¤ê¸°</h2><div class="muted">ì§ì ‘ ë‹µí•˜ê±°ë‚˜, **ì˜ˆì‹œë¡œ ìë™ ì™„ì„±**ì„ ëˆŒëŸ¬ ë°”ë¡œ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.</div></div>
      <div class="body">
        <div class="chat" id="chat"></div>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <input id="input" type="text" placeholder="ì—¬ê¸°ì— ë‹µë³€ì„ ì ê³  Enter" />
          <button class="btn ok" id="sendBtn">ë‹µë³€ ì¶”ê°€</button>
          <button class="btn warn" id="autoBtn">ì˜ˆì‹œë¡œ ìë™ ì™„ì„±</button>
          <button class="btn secondary" id="undoBtn">ì´ì „ ë¬¸ë‹¨ ì·¨ì†Œ</button>
          <button class="btn" id="makeBtn">ì†Œì„¤ ìƒì„±</button>
        </div>
        <div class="proc" id="proc" style="display:none">
          <div class="step"><div>ì•„ì´ë””ì–´ ì •ë¦¬</div><div class="bar"><div class="fill" id="p1"></div></div></div>
          <div class="step"><div>ì¥ë©´ ìŠ¤ì¼€ì¹˜</div><div class="bar"><div class="fill" id="p2"></div></div></div>
          <div class="step"><div>ê°ì •ì„  ë‹¤ë“¬ê¸°</div><div class="bar"><div class="fill" id="p3"></div></div></div>
          <div class="step"><div>ë¬¸ì¥ ì“°ê¸°</div><div class="bar"><div class="fill" id="p4"></div></div></div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="head"><h2>3) í‘œì§€ (ê·¸ë¦¼ ì´ë¯¸ì§€)</h2></div>
      <div class="body">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <input id="title" type="text" placeholder="ì œëª©(ì˜ˆ: ì˜¤ëŠ˜, ë°˜ì£½ ìœ„ë¡œ ëœ¨ëŠ” ë³„)" />
          <select id="genre"><option>ì„±ì¥</option><option>ëª¨í—˜</option><option>ìš°ì •</option><option>ì‹ ë¹„</option><option>ì›ƒìŒ</option><option>ê°ë™</option></select>
        </div>
        <div id="cover-holder" class="cover-holder"><span class="muted">ì†Œì„¤ì„ ë§Œë“  ë’¤ í‘œì§€ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.</span></div>
        <div style="display:flex;gap:8px;margin-top:10px"><button class="btn secondary" id="downCover">í‘œì§€ PNG ë‹¤ìš´ë¡œë“œ</button></div>
      </div>
      <div class="head"><h2>4) ì†Œì„¤ ë³¸ë¬¸</h2></div>
      <div class="body">
        <div class="story" id="story"></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn secondary" id="copyBtn">ë³µì‚¬í•˜ê¸°</button>
          <button class="btn" id="downTxt">ì†Œì„¤ TXT ë‹¤ìš´ë¡œë“œ</button>
          <button class="btn ok" id="mailBtn">ì´ë©”ì¼ë¡œ ë³´ë‚´ê¸°</button>
        </div>
      </div>
    </section>
  </div>
</main>

<script>
const TOPICS = [
  ["ë¯¸ìˆ ê´€ ê´€ëŒ","ğŸ¨"],["ë„ìê¸° ë§Œë“¤ê¸°","ğŸº"],["í•œì§€ê³µì˜ˆ","ğŸ“œ"],["íŒí™” ì°ê¸°","ğŸ–Œï¸"],["ìŒì•…íšŒ ê´€ëŒ","ğŸ»"],["ì—°ê·¹ ì²´í—˜","ğŸ­"],
  ["ìˆ²ì† ìƒíƒœìº í”„","ğŸŒ³"],["ë‚˜ë¬´ ì‹¬ê¸°","ğŸŒ±"],["ë†ì´Œ ì²´í—˜","ğŸšœ"],["ë°”ë‹¤ ìƒë¬¼ íƒí—˜","ğŸš"],["ì‚°ì±…ë¡œ íƒì‚¬","ğŸ¥¾"],["ë³„ë³´ê¸° ìº í”„","ğŸŒŒ"],
  ["ê³¼í•™ê´€ íƒêµ¬","ğŸ”­"],["ë¡œë´‡ ì½”ë”© ì²´í—˜","ğŸ¤–"],["ì²œì²´ ê´€ì¸¡","ğŸ›°ï¸"],["í™”ì‚° í­ë°œ ì‹¤í—˜","ğŸŒ‹"],["ì—ë„ˆì§€ ì ˆì•½ ì‹¤í—˜","âš¡"],["ìš°ì£¼ê³¼í•™ ìº í”„","ğŸš€"],
  ["ì œê³¼ì œë¹µ ë§Œë“¤ê¸°","ğŸ§"],["ìš”ë¦¬êµì‹¤","ğŸ³"],["ì „í†µì‹œì¥ íƒë°©","ğŸ›’"],["ë„ì„œê´€ ë…ì„œ ìº í”„","ğŸ“š"],["ì¬í™œìš© ê³µì˜ˆ","â™»ï¸"],["ë¬¼ë†€ì´ ì²´í—˜","ğŸŠ"],
  ["ë™ë¬¼ì› ê²¬í•™","ğŸ¦"],["ê³¤ì¶© ê´€ì°°","ğŸ¦‹"],["ë°˜ë ¤ë™ë¬¼ ëŒë³´ê¸°","ğŸ¶"],["ì–´ë¥˜ ê´€ì°°","ğŸ "],["ë™ë¬¼ë³´í˜¸ì†Œ ë´‰ì‚¬","ğŸ¾"],["ììœ  ì£¼ì œ","âœ¨"]
];
const EXAMPLES = {
  "ë¯¸ìˆ ê´€ ê´€ëŒ": ["íŒŒë€ìƒ‰ì´ í¬ê²Œ ë²ˆì§„ ê·¸ë¦¼ì„ ì˜¤ë˜ ë´¤ì–´ìš”.","ì¹œêµ¬ì™€ ê°™ì€ ë²¤ì¹˜ì— ì•‰ì•„ ì¡°ìš©íˆ ì´ì•¼ê¸°í–ˆì–´ìš”.","ê·¸ë¦¼ ì† íŒŒë„ê°€ ì§„ì§œë¡œ ì›€ì§ì´ëŠ” ê²ƒ ê°™ì•˜ì–´ìš”.","ë‚˜ê°ˆ ë•Œ ë§ˆìŒì´ ì¡°ê¸ˆ ì°¨ë¶„í•´ì¡Œì–´ìš”."],
  "ë„ìê¸° ë§Œë“¤ê¸°": ["ë‘¥ê·¼ ë¨¸ê·¸ì»µì„ ë§Œë“¤ì—ˆì–´ìš”.","í™ì´ ì†ì— ì´‰ì´‰í•˜ê²Œ ë‹¬ë¼ë¶™ì—ˆì–´ìš”.","ì¹œêµ¬ì™€ ë²ˆê°ˆì•„ê°€ë©° ë¬¼ë ˆë¥¼ ëŒë ¸ì–´ìš”.","ì™„ì„±í•˜ë‹ˆ ë¿Œë“¯í•´ì„œ ì‚¬ì§„ì„ ì°ì—ˆì–´ìš”."],
  "í•œì§€ê³µì˜ˆ": ["í•œì§€ ë¶€ì±„ë¥¼ ë§Œë“¤ì—ˆì–´ìš”.","í•œì§€ëŠ” ë¶€ë“œëŸ½ê³  ì‚´ì§ ë”°ëœ»í–ˆì–´ìš”.","í’€ì„ ë°”ë¥¼ ë•Œ ì£¼ë¦„ì´ ì•ˆ ìƒê¸°ê²Œ ì¡°ì‹¬í–ˆì–´ìš”.","ì™„ì„±í’ˆì€ ë°© ì°½ê°€ì— ë‘ê³  ì‹¶ì–´ìš”."],
  "íŒí™” ì°ê¸°": ["ê³ ì–‘ì´ê°€ ëˆ„ì›Œ ìˆëŠ” ê·¸ë¦¼ì„ ìƒˆê²¼ì–´ìš”.","ì‰í¬ ëƒ„ìƒˆê°€ ì§„í–ˆê³  ë¡¤ëŸ¬ ì†Œë¦¬ê°€ ë“œë¥´ë¥µ ë‚¬ì–´ìš”.","ì¢…ì´ë¥¼ ë–¼ëŠ” ìˆœê°„ ê·¸ë¦¼ì´ ì„ ëª…í–ˆì–´ìš”.","ì¹œêµ¬ë“¤ì´ ë©‹ì§€ë‹¤ê³  ë°•ìˆ˜ ì³ì¤¬ì–´ìš”."],
  "ìŒì•…íšŒ ê´€ëŒ": ["ë°”ì´ì˜¬ë¦°ì´ ê°€ì¥ ë§ˆìŒì— ë“¤ì—ˆì–´ìš”.","ë¬´ëŒ€ ì¡°ëª…ì´ ë”°ëœ»í•˜ê²Œ ë¹›ë‚¬ì–´ìš”.","ì„ ìƒë‹˜ê³¼ ê°™ì€ ì¤„ì—ì„œ ë“¤ì—ˆì–´ìš”.","ëŒì•„ì˜¤ëŠ” ê¸¸ì— ë©œë¡œë””ë¥¼ í¥ì–¼ê±°ë ¸ì–´ìš”."],
  "ì—°ê·¹ ì²´í—˜": ["ë‚˜ëŠ” í•´ì„¤ì ì—­í• ì„ ë§¡ì•˜ì–´ìš”.","ëŒ€ì‚¬ë¥¼ ì™¸ìš¸ ë•Œ ì¡°ê¸ˆ ë–¨ë ¸ì–´ìš”.","ë¬´ëŒ€ì— ì„œë‹ˆ ê´€ê°ì´ í¬ê²Œ ë³´ì˜€ì–´ìš”.","ëë‚˜ê³  'í•´ëƒˆë‹¤!'ë¼ê³  ì™¸ì³¤ì–´ìš”."],
  "ìˆ²ì† ìƒíƒœìº í”„": ["ìˆ² ì…êµ¬ì—ì„œ ìƒˆì†Œë¦¬ê°€ ë¨¼ì € ë“¤ë ¸ì–´ìš”.","í™ëƒ„ìƒˆë‘ ë°”ëŒì´ ì‹œì›í–ˆì–´ìš”.","ì¹œêµ¬ì™€ ë‚˜ë¬´ ì ëª¨ì–‘ì„ ë¹„êµí–ˆì–´ìš”.","ëŒì•„ê°ˆ ë•Œ ë°œê±¸ìŒì´ ê°€ë²¼ì› ì–´ìš”."],
  "ë‚˜ë¬´ ì‹¬ê¸°": ["ì€í–‰ë‚˜ë¬´ ë¬˜ëª©ì„ ì‹¬ì—ˆì–´ìš”.","ì‚½ìœ¼ë¡œ í™ì„ íŒŒë‹ˆ ë•…ì´ ì´‰ì´‰í–ˆì–´ìš”.","ë¬¼ë„ í•œ ì–‘ë™ì´ ê°€ë“ ì£¼ì—ˆì–´ìš”.","ë¹¨ë¦¬ ìë¼ì„œ ê·¸ëŠ˜ì´ ë˜ë©´ ì¢‹ê² ì–´ìš”."],
  "ë†ì´Œ ì²´í—˜": ["ìƒì¶”ë¥¼ ìˆ˜í™•í–ˆì–´ìš”.","ì¥í™”ì— í™ì´ ë¬»ì—ˆì§€ë§Œ ì¬ë¯¸ìˆì—ˆì–´ìš”.","ë†ë¶€ ì•„ì €ì”¨ê°€ ìˆ˜í™• ìš”ë ¹ì„ ì•Œë ¤ì£¼ì…¨ì–´ìš”.","ë°¥ ë¨¹ì„ ë•Œ ë‚´ê°€ ë”´ ìƒì¶”ë¥¼ ì‹¸ ë¨¹ì—ˆì–´ìš”."],
  "ë°”ë‹¤ ìƒë¬¼ íƒí—˜": ["ë¶ˆê°€ì‚¬ë¦¬ì™€ ì¡°ê°œë¥¼ ë´¤ì–´ìš”.","ë°”ë‹·ë°”ëŒ ëƒ„ìƒˆê°€ ì§­ì¡°ë¦„í–ˆì–´ìš”.","ì¹œêµ¬ì™€ ì‘ì€ ê²Œë¥¼ ì¡°ì‹¬íˆ ë†“ì•„ì¤¬ì–´ìš”.","ê°€ì¥ ì‹ ê¸°í–ˆë˜ ê±´ íˆ¬ëª…í•œ í•´íŒŒë¦¬ì˜€ì–´ìš”."],
  "ì‚°ì±…ë¡œ íƒì‚¬": ["ë‚˜ë¬´ í‘œì§€íŒì— í™”ì‚´í‘œê°€ ìˆì—ˆì–´ìš”.","ë°œê±¸ìŒì´ ë”±ë”±, ê·œì¹™ì ìœ¼ë¡œ ë“¤ë ¸ì–´ìš”.","ì˜†ì—ì„œ í•¨ê»˜ ê±¸ì€ ì¹œêµ¬ì™€ ìˆ˜ë‹¤ë¥¼ ë–¨ì—ˆì–´ìš”.","ëë‚˜ê³  ë‚˜ë‹ˆ ìˆ¨ì´ ì‹œì›í–ˆì–´ìš”."],
  "ë³„ë³´ê¸° ìº í”„": ["ë¶ë‘ì¹ ì„±ì„ ì°¾ì•˜ì–´ìš”.","ë°¤ê³µê¸°ê°€ ì°¨ê°€ì› ì–´ìš”.","ì¡°ë³„ë¡œ ë—ìë¦¬ì— ëˆ„ì› ì–´ìš”.","ë³„ì„ ë³´ë©° ì†Œì›ì„ ë¹Œì—ˆì–´ìš”."],
  "ê³¼í•™ê´€ íƒêµ¬": ["ì „ììì„ ì „ì‹œê°€ ì¬ë°Œì—ˆì–´ìš”.","ë²„íŠ¼ì„ ëˆ„ë¥´ë‹ˆ ë¶ˆë¹›ì´ ì¼œì¡Œì–´ìš”.","ì¹œêµ¬ì™€ ì™œ ê·¸ëŸ°ì§€ ì´ì•¼ê¸°í–ˆì–´ìš”.","ì „ê¸°ëŠ” ìì„ì—ë„ í˜ì„ ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ê±¸ ì•Œì•˜ì–´ìš”."],
  "ë¡œë´‡ ì½”ë”© ì²´í—˜": ["ë¡œë´‡ì´ ì•ìœ¼ë¡œ ì„¸ ê±¸ìŒ ê°”ì–´ìš”.","ëª…ë ¹ì„ ìˆœì„œëŒ€ë¡œ ë„£ëŠ” ê²Œ ì–´ë ¤ì› ì–´ìš”.","ì„ ìƒë‹˜ì´ íŒíŠ¸ë¥¼ ì£¼ì…¨ì–´ìš”.","ì„±ê³µí•˜ë‹ˆ ëª¨ë‘ê°€ í™˜í˜¸í–ˆì–´ìš”."],
  "ì²œì²´ ê´€ì¸¡": ["ë‹¬ì˜ ì›…ë©ì´ì²˜ëŸ¼ ë³´ì´ëŠ” í¬ë ˆì´í„°ë¥¼ ë´¤ì–´ìš”.","ë°¤í•˜ëŠ˜ì´ ë³´ëë¹›ìœ¼ë¡œ ì–´ë‘ì› ì–´ìš”.","ì¹œêµ¬ì™€ ë²ˆê°ˆì•„ ë§ì›ê²½ì„ ë´¤ì–´ìš”.","ë‹¬ì´ ì´ë ‡ê²Œ ê°€ê¹Œì›Œ ë³´ì¼ ì¤„ ëª°ëì–´ìš”."],
  "í™”ì‚° í­ë°œ ì‹¤í—˜": ["ë¹¨ê°„ ì†Œë‹¤ ìš©ì•¡ì´ ë¶„ì¶œëì–´ìš”.","â€˜ì‰¬ìµâ€™ í•˜ëŠ” ì†Œë¦¬ê°€ ë‚¬ì–´ìš”.","ì˜†ì—ì„œ ì¹œêµ¬ê°€ ë†€ë¼ë©° ì›ƒì—ˆì–´ìš”.","í™”ì‚°ì´ ì‹¤ì œë¡œë„ ì´ë ‡ê²Œ ë¬´ì„œìš¸ê¹Œ ìƒê°í–ˆì–´ìš”."],
  "ì—ë„ˆì§€ ì ˆì•½ ì‹¤í—˜": ["ì „êµ¬ ë°ê¸°ë¥¼ ë¹„êµí–ˆì–´ìš”.","ìˆ˜ì¹˜ê°€ ë‚´ë ¤ê°€ë‹ˆ ì‹ ê¸°í–ˆì–´ìš”.","ì§ì´ ìˆ˜ì¹˜ë¥¼ ê¸°ë¡í–ˆì–´ìš”.","ì§‘ì—ì„œë„ ë¶ˆì„ ì•„ê»´ì•¼ê² ë‹¤ê³  ìƒê°í–ˆì–´ìš”."],
  "ìš°ì£¼ê³¼í•™ ìº í”„": ["í–‰ì„± ëª¨í˜•ì„ ëŒë ¤ ë´¤ì–´ìš”.","ì‹œë®¬ë ˆì´í„°ê°€ í”ë“¤ë ¸ì–´ìš”.","ìš°ë¦¬ ì¡° ì´ë¦„ì€ â€˜ì€í•˜â€™ì˜€ì–´ìš”.","ë§ˆì§€ë§‰ì— ìš°ì£¼ì¸ì²˜ëŸ¼ ì¸ì‚¬í–ˆì–´ìš”."],
  "ì œê³¼ì œë¹µ ë§Œë“¤ê¸°": ["ì´ˆì½”ë¨¸í•€ì„ ë§Œë“¤ì—ˆì–´ìš”.","ë°˜ì£½ì´ ì†ì— ì«€ì«€í•˜ê²Œ ë¶™ì—ˆì–´ìš”.","ì—­í• ì„ ë‚˜ëˆ ì„œ ì¬ë£Œë¥¼ ì„ì—ˆì–´ìš”.","ì˜¤ë¸ì—ì„œ í–¥ì´ í¼ì ¸ì„œ í–‰ë³µí–ˆì–´ìš”."],
  "ìš”ë¦¬êµì‹¤": ["ì•¼ì±„ë³¶ìŒì„ ë§Œë“¤ì—ˆì–´ìš”.","ì´ˆë¡ìƒ‰ê³¼ ì£¼í™©ìƒ‰ì´ ì˜ˆë»¤ì–´ìš”.","ì„ ìƒë‹˜ì´ ë§›ì„ ë´ì£¼ì…¨ì–´ìš”.","ì™„ì„±í•˜ê³  ëª¨ë‘ ê°™ì´ ë¨¹ì—ˆì–´ìš”."],
  "ì „í†µì‹œì¥ íƒë°©": ["íŠ€ê¹€ ê°€ê²Œê°€ ì¬ë¯¸ìˆì—ˆì–´ìš”.","ì‹œì¥ ì†Œë¦¬ê°€ ì™ìì§€ê»„í–ˆì–´ìš”.","ì¹œêµ¬ì™€ êµ°ê²ƒì§ˆì„ ë‚˜ëˆ  ë¨¹ì—ˆì–´ìš”.","ë„¤ì˜¨ ë¶ˆë¹›ì´ ë°˜ì§ì˜€ì–´ìš”."],
  "ë„ì„œê´€ ë…ì„œ ìº í”„": ["ëª¨í—˜ ì´ì•¼ê¸°ë¥¼ ì½ì—ˆì–´ìš”.","ì¢…ì´ ëƒ„ìƒˆê°€ ë‚¬ì–´ìš”.","ì¹œêµ¬ì™€ ì¡°ìš©íˆ ì¤„ê±°ë¦¬ ì´ì•¼ê¸°ë¥¼ í–ˆì–´ìš”.","ì±…ì„ ë®ì„ ë•Œ ê¸°ë¶„ì´ ì¢‹ì•˜ì–´ìš”."],
  "ì¬í™œìš© ê³µì˜ˆ": ["í˜íŠ¸ë³‘ìœ¼ë¡œ ì—°í•„ê½‚ì´ë¥¼ ë§Œë“¤ì—ˆì–´ìš”.","ìŠ¤í‹°ì»¤ë¥¼ ë¶™ì´ë‹ˆ ìƒˆê²ƒ ê°™ì•˜ì–´ìš”.","ì¹œêµ¬ê°€ í…Œì´í”„ë¥¼ ì¡ì•„ì¤¬ì–´ìš”.","ì±…ìƒ ìœ„ì— ë‘ê³  ì“°ê³  ì‹¶ì–´ìš”."],
  "ë¬¼ë†€ì´ ì²´í—˜": ["ìˆ˜ì˜ì¥ì—ì„œ ë†€ì•˜ì–´ìš”.","ë¬¼ì˜ ì˜¨ë„ê°€ ì‹œì›í–ˆì–´ìš”.","ê°™ì´ ë›°ì–´ë“¤ë©° ë¬¼ë³´ë¼ê°€ íŠ€ì—ˆì–´ìš”.","ê°€ì¥ ì¬ë¯¸ìˆë˜ ê±´ ë¬¼íŠ€ê¸°ê¸°ì˜€ì–´ìš”."],
  "ë™ë¬¼ì› ê²¬í•™": ["ê¸°ë¦°ì„ ì˜¤ë˜ ë´¤ì–´ìš”.","ê±¸ì„ ë•Œ ë‹¤ë¦¬ê°€ ê¸¸ê²Œ í”ë“¤ë ¸ì–´ìš”.","ì¹œêµ¬ì™€ í‚¤ë¥¼ ë¹„êµí•´ ë´¤ì–´ìš”.","ê¸°ë¦°ë„ ìš°ë¦¬ë¥¼ ë³´ê³  ìˆì„ê¹Œ ìƒê°í–ˆì–´ìš”."],
  "ê³¤ì¶© ê´€ì°°": ["ë¬´ë‹¹ë²Œë ˆë¥¼ ê´€ì°°í–ˆì–´ìš”.","ë‚ ê°œ ë¬´ëŠ¬ê°€ ë°˜ì§ì˜€ì–´ìš”.","ë£¨í˜ë¡œ ìì„¸íˆ ë´¤ì–´ìš”.","ì‘ì€ ìƒëª…ë„ ì†Œì¤‘í•˜ë‹¤ëŠ” ê±¸ ëŠê¼ˆì–´ìš”."],
  "ë°˜ë ¤ë™ë¬¼ ëŒë³´ê¸°": ["ê°•ì•„ì§€ë¥¼ ì”»ê²¨ ì¤¬ì–´ìš”.","í„¸ì´ ë³´ì†¡ë³´ì†¡í•´ì¡Œì–´ìš”.","ì¹œêµ¬ì™€ ë“œë¼ì´ê¸°ë¡œ ë§ë ¸ì–´ìš”.","ê°•ì•„ì§€ê°€ ê¼¬ë¦¬ë¥¼ í”ë“¤ì—ˆì–´ìš”."],
  "ì–´ë¥˜ ê´€ì°°": ["ê¸ˆë¶•ì–´ë¥¼ ë´¤ì–´ìš”.","ë¬¼ë¹›ì´ ë°˜ì§ì˜€ì–´ìš”.","ì¹œêµ¬ì™€ ì¡°ìš©íˆ ì´ì•¼ê¸°í–ˆì–´ìš”.","ëŒì•„ê°€ëŠ” ê¸¸ì— ë¬¼ê³ ê¸°ì²˜ëŸ¼ í—¤ì—„ì¹˜ëŠ” í‰ë‚´ë¥¼ ëƒˆì–´ìš”."],
  "ë™ë¬¼ë³´í˜¸ì†Œ ë´‰ì‚¬": ["ì‚¬ë£Œë¥¼ ë‚˜ë¥´ê³  ìš°ë¦¬ë¥¼ ì²­ì†Œí–ˆì–´ìš”.","ê°•ì•„ì§€ë“¤ì´ ë°˜ê°‘ê²Œ ì§–ì—ˆì–´ìš”.","ê°™ì´ ì˜¨ ì¹œêµ¬ì™€ ë¬¼ê·¸ë¦‡ì„ ì±„ì› ì–´ìš”.","ëŒì•„ì˜¬ ë•Œ ë§ˆìŒì´ ë”°ëœ»í–ˆì–´ìš”."],
  "ììœ  ì£¼ì œ": ["ìƒˆë¡œìš´ ì¥ì†Œì—ì„œ ì¬ë¯¸ìˆëŠ” ê±¸ í•´ ë´¤ì–´ìš”.","ì²˜ìŒì—” ì¡°ê¸ˆ ë‚¯ì„¤ì—ˆì–´ìš”.","ì¹œêµ¬ì™€ í•¨ê»˜í•´ì„œ ë“ ë“ í–ˆì–´ìš”.","ëŒì•„ê°ˆ ë•ŒëŠ” ìì‹ ê°ì´ ìƒê²¼ì–´ìš”."]
};
const QUESTIONS = ["ë¬´ì—‡ì„ ë³´ê±°ë‚˜ ë§Œë“¤ì—ˆë‚˜ìš”?","ëˆ„êµ¬ì™€ í•¨ê»˜ í–ˆë‚˜ìš”?","ê°€ì¥ ì¬ë¯¸ìˆì—ˆë˜ ìˆœê°„ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?","ëŒì•„ì˜¬ ë•Œ ë§ˆìŒì€ ì–´ë• ë‚˜ìš”?"];

const $ = (id)=>document.getElementById(id);
const topicsBox = $("topics"), chat=$("chat"), story=$("story"), proc=$("proc");
const input=$("input");
let state = { topic:"", step:0, answers:[], keywords:new Set(), coverB64:"" };

function renderTopics(){
  topicsBox.innerHTML="";
  TOPICS.forEach(([name,icon],i)=>{
    const el=document.createElement("button");
    el.className="topic"; el.innerHTML=`<div class="icon">${icon}</div><div>${i+1}. ${name}</div>`;
    el.onclick=()=> startTopic(name, el); topicsBox.appendChild(el);
  });
}
function startTopic(name, el){
  document.querySelectorAll(".topic").forEach(b=>b.classList.remove("active"));
  el && el.classList.add("active");
  state.topic = name; state.step=0; state.answers=[]; state.keywords=new Set(); state.coverB64="";
  chat.innerHTML=""; story.textContent=""; $("cover-holder").innerHTML='<span class="muted">ì†Œì„¤ì„ ë§Œë“  ë’¤ í‘œì§€ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.</span>';
  addMsg(`ì²´í—˜ ì£¼ì œ: ${name} â€” ì§ˆë¬¸ì— ë‹µí•˜ê±°ë‚˜ â€˜ì˜ˆì‹œë¡œ ìë™ ì™„ì„±â€™ì„ ëˆŒëŸ¬ ë³´ì„¸ìš”.`,"ai");
  askNext();
}
function addMsg(text, role="ai"){
  const box=document.createElement("div"); box.className="msg "+role;
  const icon=document.createElement("div"); icon.className="role"; icon.textContent=role==="ai"?"ğŸ¤–":"ğŸ™‚";
  const bubble=document.createElement("div"); bubble.className="bubble"; bubble.textContent=text;
  box.appendChild(icon); box.appendChild(bubble); chat.appendChild(box); chat.scrollTop=chat.scrollHeight;
}
function askNext(){
  if(state.step < QUESTIONS.length){ addMsg(QUESTIONS[state.step],"ai"); input.placeholder="ì—¬ê¸°ì— ë‹µì„ ì ê³  Enter"; input.focus(); }
  else{ addMsg("ë‹µë³€ ìˆ˜ì§‘ ë! ì´ì œ â€˜ì†Œì„¤ ìƒì„±â€™ì„ ëˆ„ë¥´ì„¸ìš”.","ai"); }
}
function mineKeywords(t){
  const map=[["sea",/[ë°”ë‹¤|í•´ë³€|íŒŒë„|ì¡°ê°œ|ëª¨ë˜]/],["forest",/[ìˆ²|ë‚˜ë¬´|ì´ˆë¡|ì‚°ì±…]/],["market",/[ì‹œì¥|ê°€ê²Œ|ë„¤ì˜¨]/],["library",/[ë„ì„œê´€|ì±…|ì¡°ìš©]/],["night",/[ë³„|ë°¤|ë‹¬|ë…¸ì„]/],["bakery",/[ë¹µ|ë°˜ì£½|ì˜¤ë¸|ë‹¬ì½¤]/],["zoo",/[ë™ë¬¼|í„¸|ì‚¬ìœ¡]/],["insect",/[ê³¤ì¶©|ë‚ ê°œ|ì• ë²Œë ˆ]/],["robot",/[ë¡œë´‡|ì½”ë”©|ë²„íŠ¼|ì„¼ì„œ]/],["space",/[ìš°ì£¼|í–‰ì„±|ë§ì›ê²½]/],["water",/[ìˆ˜ì˜|ë¬¼ë†€ì´|ë¬¼ë³´ë¼]/],["clay",/[ë„ìê¸°|í™|ë¬¼ë ˆ]/],["print",/[íŒí™”|ì‰í¬|ë¡¤ëŸ¬]/],["paper",/[í•œì§€|ê³µì˜ˆ]/]];
  map.forEach(([k,re])=>{ if(re.test(t)) state.keywords.add(k); });
}
function progress(step){
  $("proc").style.display="grid";
  ["p1","p2","p3","p4"].forEach((id,idx)=>{ $(id).style.width = (idx<step? "100%": idx===step? "30%":"0"); });
}
function finishProgress(){
  ["p1","p2","p3","p4"].forEach(id=>$(id).style.width="100%");
  setTimeout(()=>{ $("proc").style.display="none"; ["p1","p2","p3","p4"].forEach(id=>$(id).style.width="0"); }, 600);
}

async function callStory(topic, answers, onChunk){
  const res = await fetch("/api/story", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ topic, answers })
  });
  const reader = res.body.getReader();
  const decoder = new TextDecoder("utf-8");
  let buf = "";
  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    buf += decoder.decode(value, { stream: true });
    const parts = buf.split("\\n");
    for(const line of parts){
      if(line.startsWith("data: ")){
        const chunk = line.slice(6).trim();
        if(chunk === "[DONE]") continue;
        try{
          const j = JSON.parse(chunk);
          const token = j.output_text ?? j.delta ?? "";
          onChunk(token);
        }catch{}
      }
    }
    buf = parts[parts.length-1].startsWith("data: ") ? "" : parts[parts.length-1];
  }
}
async function callCover(topic, keywords){
  const r = await fetch("/api/cover", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ topic, keywords: Array.from(keywords||[]) })
  });
  const { b64 } = await r.json();
  const holder = $("cover-holder"); holder.innerHTML="";
  if(!b64){ holder.innerHTML = '<span style="padding:10px;border:1px solid #334155;border-radius:10px;background:#12233f">í‘œì§€ ìƒì„± ì‹¤íŒ¨</span>'; return; }
  const img = new Image(); img.src = "data:image/png;base64," + b64; img.alt = "AI í‘œì§€"; holder.appendChild(img);
}

// Events
$("sendBtn").onclick=()=>{
  const text=input.value.trim(); if(!text) return;
  addMsg(text,"me"); state.answers[state.step]=text; input.value="";
  mineKeywords(text); state.step++; askNext();
};
$("input").addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); $("sendBtn").click(); }});
$("autoBtn").onclick=()=>{
  const t = state.topic || "ììœ  ì£¼ì œ";
  const ex = EXAMPLES[t] || EXAMPLES["ììœ  ì£¼ì œ"];
  chat.innerHTML=""; story.textContent=""; state.step=0; state.answers=[]; state.keywords=new Set(); state.coverB64="";
  addMsg("ì˜ˆì‹œ ë‹µë³€ìœ¼ë¡œ ìë™ ì¤€ë¹„í•©ë‹ˆë‹¤.","ai");
  ex.slice(0,4).forEach((ans,i)=>{ addMsg(ans,"me"); state.answers[i]=ans; mineKeywords(ans); });
  askNext();
};
$("makeBtn").onclick=async()=>{
  const topic = state.topic || "ììœ  ì£¼ì œ";
  if(state.answers.length<4){ addMsg("ë‹µë³€ì´ 4ê°œ ë¯¸ë§Œì…ë‹ˆë‹¤. ê³„ì† ë‹µí•˜ê±°ë‚˜ â€˜ì˜ˆì‹œë¡œ ìë™ ì™„ì„±â€™ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.","ai"); return; }
  story.textContent=""; progress(0);
  setTimeout(()=>progress(1),300); setTimeout(()=>progress(2),800); setTimeout(()=>progress(3),1300);
  const para=document.createElement("p"); para.textContent="ã€€"; story.appendChild(para);
  await callStory(topic, state.answers, (chunk)=>{ para.textContent += chunk; story.scrollTop=story.scrollHeight; });
  finishProgress();
  if(!$("title").value.trim()){ $("title").value = `${topic}ì—ì„œ ëŠë‚€ í•˜ë£¨`; }
  await callCover(topic, state.keywords);
};
$("undoBtn").onclick=()=>{
  const msgs = chat.querySelectorAll(".msg.me");
  if(msgs.length>0){ msgs[msgs.length-1].remove(); }
  if(state.step>0){ state.step--; state.answers.pop(); addMsg("ë°©ê¸ˆ ë‹µë³€ì„ ì·¨ì†Œí–ˆì–´ìš”. ë‹¤ì‹œ ì ì–´ ì£¼ì„¸ìš”.","ai"); }
};
$("resetBtn").onclick=()=>{ location.reload(); };
$("downCover").onclick=()=>{
  const holder = $("cover-holder"); const img = holder.querySelector("img"); if(!img){ alert("í‘œì§€ê°€ ì•„ì§ ì—†ì–´ìš”."); return; }
  const a=document.createElement("a"); a.href=img.src; a.download=(($("title").value)||"ë‚´ ì†Œì„¤ í‘œì§€")+".png"; a.click();
};
$("copyBtn").onclick=()=>navigator.clipboard.writeText(story.textContent.trim());
$("downTxt").onclick=()=>{ const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([story.textContent.trim()],{type:"text/plain;charset=utf-8"})); a.download=(($("title").value)||"ë‚´ ì†Œì„¤")+".txt"; a.click(); URL.revokeObjectURL(a.href); };
$("mailBtn").onclick=()=>{ const email = prompt("ë°›ëŠ” ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ):",""); const subject="AI ì²´í—˜ì†Œì„¤ â€” "+(($("title").value)||"ë‚´ ì†Œì„¤"); const body=encodeURIComponent(story.textContent.trim()); location.href=`mailto:${encodeURIComponent(email||"")}?subject=${encodeURIComponent(subject)}&body=${body}`; };

function boot(){
  renderTopics();
  addMsg("ì²´í—˜ ì£¼ì œë¥¼ ê³ ë¥´ê±°ë‚˜, ì•„ë˜ ì¹¸ì— ììœ  ì£¼ì œë¥¼ ì ì–´ ì‹œì‘í•˜ì„¸ìš”.","ai");
}
document.getElementById("useCustom").onclick=()=>{
  const t = document.getElementById("customTopic").value.trim(); if(!t) return;
  startTopic(t, null);
};
boot();
</script>
</body>
</html>
